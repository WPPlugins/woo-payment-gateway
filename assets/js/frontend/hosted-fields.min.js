jQuery(function(e){if("undefined"!=typeof braintree_hosted_fields_vars){var t={container:".payment_method_"+braintree_hosted_fields_vars.gateway_id,new_method_container:".bfwc-new-payment-method-container",token_selector:".bfwc-payment-method-token",nonce_selector:".bfwc-nonce-value",device_data_selector:".bfwc-device-data",icon_style:braintree_hosted_fields_vars.dynamic_card_display.icon_style,init:function(){this.assign_parent_class(),setInterval(this.check_hosted_fields,1500),e(t.container).closest("form").on("checkout_place_order_"+braintree_hosted_fields_vars.gateway_id,this.woocommerce_form_submit),e(document.body).on("updated_checkout",this.check_hosted_fields),e(document.body).on("updated_checkout",this.maybe_update_vars),e(t.container).closest("form").on("woocommerce_form_submit_"+braintree_hosted_fields_vars.gateway_id,this.woocommerce_form_submit),e(t.container).closest("form").on("woocommerce_form_submit_"+braintree_hosted_fields_vars.gateway_id,this.maybe_set_device_data),e(document.body).on("bfwc_pre_form_submit_"+braintree_hosted_fields_vars.gateway_id,this.maybe_set_device_data),e(document.body).on("checkout_error",this.checkout_error),e(document.body).on("braintree_checkout_initiated",this.display_loader),e(document.body).on("braintree_tokenization_error",this.remove_loader),e(document.body).on("checkout_error",this.remove_loader),braintree_hosted_fields_vars.dynamic_card_display.enabled&&e(document.body).on("braintree_card_type_change",this.card_type_change),e(document.body).on("click","#place_order",this.submit_payment_method),e(document.body).on("bfwc_get_hosted_fields_instance",this.get_instance_of_hosted_fields),this.initialize_functionality()},assign_parent_class:function(){e('input[name="payment_method"]').each(function(){var t=e(this).val();e(this).closest("li").hasClass("payment_method_"+t)||e(this).closest("li").addClass("payment_method_"+t)})},initialize_functionality:function(){"undefined"!=typeof braintree_hosted_fields_client_token?(e(document.body).trigger("braintree_before_form_initialize"),braintree.client.create({authorization:braintree_hosted_fields_client_token},function(e,n){e?t.submit_error(e):(t.clientInstance=n,t.initialize_hosted_instance(),t.initialize_fraud_tools(),t.initialize_3d_secure())})):this.submit_error({code:"INVALID_CLIENT_TOKEN"})},initialize_hosted_instance:function(){e(t.container).length&&t.clientInstance&&braintree.hostedFields.create({client:t.clientInstance,styles:braintree_hosted_fields_vars.form_styles,fields:t.get_hosted_fields()},function(n,r){if(n){if("HOSTED_FIELDS_FIELD_DUPLICATE_IFRAME"===n.code)return;return void t.submit_error(n)}t.hostedFieldsInstance=r,t.hostedFieldsInstance.on("validityChange",t.validity_change),t.hostedFieldsInstance=r,e.each(t.events,function(t,n){r.on(t,function(t){e(document.body).triggerHandler(n,t)})})})},initialize_3d_secure:function(){braintree_hosted_fields_vars._3ds.enabled&&braintree.threeDSecure.create({client:t.clientInstance},function(n,r){if(n)return t.threeds_error=n,void t.submit_error(n);t.threeDSecureInstance=r,e("body").addClass("bfwc-3ds")})},submit_payment_method:function(n){if(t.is_gateway_selected())if(t.is_payment_method_selected()){if(e(document.body).triggerHandler("braintree_checkout_initiated"),!braintree_hosted_fields_vars._3ds.active||!braintree_hosted_fields_vars._3ds.verify_vault)return!0;n.preventDefault(),t.process_3dsecure_vaulted()}else n.preventDefault(),t.tokenize_method()},tokenize_method:function(n){e(document.body).triggerHandler("braintree_checkout_initiated"),t.hostedFieldsInstance.tokenize(function(e,n){if(e)return t.submit_error(e),void t.handle_tokenization_error(e);braintree_hosted_fields_vars._3ds.active?t.process_3dsecure(n):t.on_payment_method_received(n)})},submit_error:function(n){e(document.body).triggerHandler("bfwc_submit_error",{error:n,element:t.container,fields:t.get_hosted_fields()})},process_3dsecure:function(n){t.threeDSecureInstance?t.threeDSecureInstance.verifyCard({amount:e("#bfwc_cart_total").length?e("#bfwc_cart_total").val():braintree_hosted_fields_vars.order_total,nonce:n.nonce,addFrame:t.add_3ds_frame,removeFrame:t.remove_3ds_frame},function(e,n){if(e)return t.submit_error(e),void t.remove_loader();t.remove_3ds_frame(),t.on_payment_method_received(n),t.display_loader()}):t.submit_error(t.threeds_error)},process_3dsecure_vaulted:function(){t.block_form(),e.when(t.payment_nonce_request(t.get_payment_token())).done(function(e){e.success?t.process_3dsecure({nonce:e.data}):(t.submit_error(e.data),t.unblock_form())}).fail(function(e,n,r){t.submit_error({message:r}),t.unblock_form()})},handle_tokenization_error:function(n){"HOSTED_FIELDS_FIELDS_INVALID"===n.code?e.each(n.details.invalidFieldKeys,function(n,r){var i=t.get_hosted_fields()[r];e(i.selector).braintreeInvalidField()}):"HOSTED_FIELDS_FIELDS_EMPTY"===n.code&&e.each(t.get_hosted_fields(),function(t,n){e(n.selector).braintreeInvalidField()}),e(document.body).trigger("braintree_tokenization_error",{err:n,fields:t.get_hosted_fields()})},initialize_fraud_tools:function(){braintree_hosted_fields_vars.advanced_fraud.enabled&&braintree.dataCollector.create({client:t.clientInstance,kount:!0,paypal:!0},function(e,n){e?t.submit_error(e):t.dataCollectorInstance=n})},on_payment_method_received:function(n){t.payment_method_received=!0,e(t.container).find(t.nonce_selector).val(n.nonce),e(t.container).closest("form").submit()},check_hosted_fields:function(){t.assign_parent_class(),e(t.container).find(t.new_method_container).find("iFrame").length||t.initialize_hosted_instance(),t.check_container_size()},check_container_size:function(){e(".payment_methods").width()<475?e("div.braintree-payment-gateway").addClass("small-container"):e("div.braintree-payment-gateway").removeClass("small-container"),e(document.body).trigger("bfwc_container_size_check",t.get_hosted_fields())},get_hosted_fields:function(){return t.hosted_fields||(t.hosted_fields={},e.each(braintree_hosted_fields_vars.custom_fields,function(n,r){e(r.selector).length&&(r.placeholder=e(r.selector).attr("data-placeholder"),t.hosted_fields[n]=r)})),t.hosted_fields},checkout_error:function(){t.payment_method_received=!1},is_payment_method_selected:function(){return e(t.container).find(t.token_selector).length>0&&""!==e(t.container).find(t.token_selector).val()},is_gateway_selected:function(){return e('input[name="payment_method"]:checked').val()===braintree_hosted_fields_vars.gateway_id},get_payment_token:function(){return e(t.container).find(t.token_selector).val()},teardown:function(e){if(t.hostedFieldsInstance)try{t.hostedFieldsInstance.teardown(function(){t.payment_method_received=!1,e&&e()})}catch(n){t.payment_method_received=!1,e&&e()}},woocommerce_form_submit:function(){return!!t.is_payment_method_selected()||!!t.payment_method_received},maybe_update_vars:function(n){if(braintree_hosted_fields_vars._3ds.enabled){t.block_form();var r={bfwc_handle:"hosted-fields",security:braintree_hosted_fields_vars.update_checkout_nonce,billing_country:e("#billing_country").val(),shipping_country:e("#shipping_country").val()};e.ajax({type:"POST",url:braintree_hosted_fields_vars.wc_ajax_url.toString().replace("%%endpoint%%","bfwc_updated_checkout"),data:r,success:function(e){t.unblock_form(),e.success&&(braintree_hosted_fields_vars=e.data)},error:function(e,n,r){t.unblock_form()}})}},payment_nonce_request:function(t){return e.ajax({type:"POST",url:braintree_hosted_fields_vars.wc_ajax_url.toString().replace("%%endpoint%%","generate_payment_nonce"),data:{security:braintree_hosted_fields_vars.payment_method_nonce,bfwc_payment_token:t}})},maybe_set_device_data:function(){return t.dataCollectorInstance&&e(t.container).find(t.device_data_selector).val(t.dataCollectorInstance.deviceData),!0},add_3ds_frame:function(n,r){n?t.submit_error(n):(t.remove_loader(),e("body").prepend('<div class="braintree-3ds-overlay"></div>'),e("body .braintree-3ds-overlay").fadeIn(400),e("body").prepend(braintree_hosted_fields_vars._3ds.modal_html),e(".threeDS-frame-body").append(r),e("#braintree_3ds_hosted_modal").fadeIn(400),e(".threeDS-cancel").on("click",t.remove_3ds_frame))},remove_3ds_frame:function(n){e("body .braintree-3ds-overlay").fadeOut(400,function(){e(this).remove()}),e("body .threeDS-hosted-modal").fadeOut(400,function(){e(this).remove()}),t.unblock_form(),t.threeDSecureInstance.cancelVerifyCard(function(e,n){e&&t.submit_error(e)})},display_loader:function(){braintree_hosted_fields_vars.loader.enabled&&e(".bfwc-payment-loader").fadeIn(200)},remove_loader:function(){e(".bfwc-payment-loader").fadeOut(200)},block_form:function(){e(t.container).closest("form").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_form:function(){e(t.container).closest("form").unblock()},events:{validityChange:"braintree_field_validity_change",cardTypeChange:"braintree_card_type_change",empty:"braintree_field_empty",notEmpty:"braintree_field_not_empty",focus:"braintree_field_focus",blur:"braintree_field_blur",inputSubmitRequest:"braintree_card_input_submit_request"},card_type_change:function(n,r){1===r.cards.length?(e(".bfwc-card-type").attr("class","bfwc-card-type").addClass(t.icon_style+" "+r.cards[0].type),t.current_card_type=r.cards[0].type):e(".bfwc-card-type").attr("class","bfwc-card-type")},validity_change:function(t){var n=t.fields[t.emittedBy];n.isValid||!n.isValid&&!n.isPotentiallyValid?e(n.container).removeClass("braintree-hosted-fields-focused"):e(n.container).addClass("braintree-hosted-fields-focused")},get_instance_of_hosted_fields:function(){return t.hostedFieldsInstance}};t.init(),e.fn.braintreeInvalidField=function(){e(this).addClass("braintree-hosted-fields-invalid")}}});